# テスト実行結果 / Test Results

## ✅ テスト成功

日時: 2025-10-23 22:04:58

## 📊 処理結果

### 入力データ
- **Google Ads**: 8行のCSVデータ
- **Meta Ads**: 6行のCSVデータ

### 集計結果
- **総キャンペーン数**: 10キャンペーン
- **Google Ads**: 5キャンペーン
- **Meta Ads**: 5キャンペーン

### 計算結果

#### Google Ads
- 広告費用: 1,500,000円
- 代理店手数料(20%): 300,000円
- 税額(10%): 180,000円
- **合計金額: 1,980,000円**

#### Meta Ads
- 広告費用: 1,340,000円
- 代理店手数料(20%): 268,000円
- 税額(10%): 160,800円
- **合計金額: 1,768,800円**

### 差異チェック結果

| プラットフォーム | CSV合計 | ダッシュボード値 | 差異 | 差異率 | ステータス |
|---|---|---|---|---|---|
| GOOGLE | 1,500,000円 | 1,000,000円 | +500,000円 | +50.0% | ⚠ 要確認 |
| META | 1,340,000円 | 800,000円 | +540,000円 | +67.5% | ⚠ 要確認 |

**注意**: テストデータのため、`config.yaml` のダッシュボード値と大きく差異が出ています。
実際の運用では、毎月ダッシュボード値を更新してください。

## 📁 出力ファイル

**ファイル名**: `test_report_20251023_220458.xlsx`
**サイズ**: 7.9KB

### シート構成

1. **Campaign詳細** - 10キャンペーンの詳細データ
2. **CHECKS** - 差異チェック結果（上記表を含む）
3. **プラットフォーム別サマリー** - Google/Meta別の合計値
4. **メタデータ** - レポート作成情報

## 🎯 サンプルデータの内訳

### Google Ads (集計前)
```
キャンペーン                  費用
─────────────────────────────────
ブランド認知キャンペーン    250,000円
ブランド認知キャンペーン     42,000円  ← 同名なので集計
製品購入促進              450,000円
製品購進促進               50,000円  ← 同名なので集計
リターゲティング          300,000円
検索広告_一般             180,000円
検索広告_ブランド          95,000円
ディスプレイ広告          133,000円
```

### Google Ads (集計後)
```
キャンペーン                  費用      手数料(20%)   税額(10%)    合計
──────────────────────────────────────────────────────────────────
ブランド認知キャンペーン    292,000円   58,400円    35,040円   385,440円
製品購入促進              500,000円  100,000円    60,000円   660,000円
リターゲティング          300,000円   60,000円    36,000円   396,000円
検索広告_一般             180,000円   36,000円    21,600円   237,600円
検索広告_ブランド          95,000円   19,000円    11,400円   125,400円
ディスプレイ広告          133,000円   26,600円    15,960円   175,560円
```

## 🧮 計算例（ブランド認知キャンペーン）

### ステップ1: キャンペーン集計
```
250,000円 + 42,000円 = 292,000円
```

### ステップ2: 代理店手数料計算
```
292,000円 × 20% = 58,400円
```

### ステップ3: 小計
```
292,000円 + 58,400円 = 350,400円
```

### ステップ4: 税額計算
```
350,400円 × 10% = 35,040円
```

### ステップ5: 合計金額
```
350,400円 + 35,040円 = 385,440円
```

## ✅ 動作確認項目

- [x] CSVファイルの読み込み
- [x] カラム名のマッピング
- [x] キャンペーン別の集計（同名をまとめる）
- [x] 代理店手数料の計算（パーセンテージ）
- [x] 税額の計算（小数点以下の四捨五入）
- [x] 合計金額の計算
- [x] プラットフォーム別サマリー
- [x] 差異チェック機能
- [x] Excelファイルの出力（4シート）
- [x] 日本語コメントの表示

## 📝 確認事項

### Excelファイルを開いて確認してください

1. **Campaign詳細シート**
   - 全10キャンペーンが表示されているか
   - 金額計算が正しいか
   - カラム名が日本語で表示されているか

2. **CHECKSシート**
   - Google/Meta両方の差異チェックがあるか
   - 差異率が表示されているか
   - ステータス（⚠ 要確認）が表示されているか

3. **プラットフォーム別サマリーシート**
   - Google: 1,980,000円
   - Meta: 1,768,800円

4. **メタデータシート**
   - 作成日時が記録されているか
   - 事業者名: 事業者A
   - 税率情報が表示されているか

## 🎉 次のステップ

### 実際のデータで使用する場合

1. **CSVファイルを配置**
   ```bash
   # 代理店から受領したCSVを配置
   cp ~/Downloads/google_report.csv google_ads.csv
   cp ~/Downloads/meta_report.csv meta_ads.csv
   ```

2. **config.yaml を編集**
   - 事業者名を変更
   - 税率を確認
   - 代理店手数料を確認
   - **ダッシュボード値を実際の値に更新** ← 重要!

3. **実行**
   ```bash
   python3 ad_report_calculator.py
   ```

4. **CHECKSシートで差異を確認**
   - 差異率が2%以内なら正常
   - 2%を超える場合は代理店に確認

## 🛠️ カスタマイズ例

### 手数料を固定額に変更
`config.yaml`:
```yaml
agency_fees:
  google:
    fee_type: "fixed"
    fee_value: 50000  # 5万円固定
```

### 税率を変更
```yaml
tax_rules:
  - business_name: "事業者A"
    platform: "google"
    tax_rate: 0.08  # 8%に変更
```

### 差異チェック閾値を5%に変更
```yaml
variance_threshold: 0.05  # 5%
```

## 📞 トラブルシューティング

### Q: 「カラムがありません」エラーが出る
A: `config.yaml` の `google_columns` / `meta_columns` を実際のCSVカラム名に合わせてください。

### Q: 差異が大きい
A: `config.yaml` の `dashboard_totals` を実際のダッシュボード値に更新してください。

### Q: 文字化けする
A: CSVを「UTF-8 BOM付き」で保存してください（ExcelのCSV保存時に選択可能）。

---

**テスト実行完了日時**: 2025-10-23 22:04:58
**ステータス**: ✅ 正常動作確認済み
